<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Course Correct Labs ‚Äî AI Research & Evaluation</title>
  <meta name="description" content="Reproducible evaluations for AI behavior: confidence calibration, temporal drift, and delegated introspection. Research-backed tools to keep AI useful, honest, and aligned." />
  <meta name="keywords" content="AI evaluation, RLHF, confidence calibration, temporal drift, AI safety, LLM testing, AI research, epistemic alignment" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://course-correct-labs.github.io/course-correct-labs-site/" />
  <meta property="og:title" content="Course Correct Labs ‚Äî AI Research & Evaluation" />
  <meta property="og:description" content="Reproducible evaluations for AI behavior: confidence calibration, temporal drift, and delegated introspection." />
  <meta property="og:image" content="https://course-correct-labs.github.io/course-correct-labs-site/assets/images/logo.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://course-correct-labs.github.io/course-correct-labs-site/" />
  <meta property="twitter:title" content="Course Correct Labs ‚Äî AI Research & Evaluation" />
  <meta property="twitter:description" content="Reproducible evaluations for AI behavior: confidence calibration, temporal drift, and delegated introspection." />
  <meta property="twitter:image" content="https://course-correct-labs.github.io/course-correct-labs-site/assets/images/logo.png" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://course-correct-labs.github.io/course-correct-labs-site/" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/images/favicon.png" />
  <link rel="apple-touch-icon" href="assets/images/favicon.png" />
  <style>
    :root { --bg:#0b0b10; --fg:#fff; --muted:rgba(255,255,255,.75); --blue:#3b82f6; --teal:#14b8a6; --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.12); }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--fg);background:var(--bg)}
    a{text-decoration:none;color:var(--fg)}
    .container{max-width:1120px;margin:0 auto;padding:0 1.25rem}

    /* nav */
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(6px);background:rgba(0,0,0,.45)}
    .nav{height:64px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:.65rem;font-weight:600;letter-spacing:.2px}
    .logo{height:48px;width:auto;display:block}
    .menu{display:none;gap:1rem;font-size:.95rem}
    .menu a{opacity:.8}
    .menu a.active{color:var(--blue);opacity:1}
    .hamburger{display:inline-flex;background:transparent;border:0;color:var(--fg);padding:.5rem;border-radius:.5rem}
    @media (min-width:768px){ .menu{display:flex} .hamburger{display:none} }
    .mobile{display:none;border-top:1px solid var(--border);background:rgba(0,0,0,.7)}
    .mobile a{display:block;padding:.75rem 1rem;border-bottom:1px solid var(--border);opacity:.85}

    /* hero */
    .hero{position:relative;padding:104px 0 80px;background:
      radial-gradient(1200px 600px at 50% -20%, rgba(59,130,246,.25), transparent 60%),
      radial-gradient(800px 400px at 80% 10%, rgba(20,184,166,.20), transparent 60%),
      radial-gradient(800px 400px at 20% 10%, rgba(236,72,153,.18), transparent 60%)}
    .hero .container{ text-align:center }
    .hero .cta{ justify-content:center }
    .eyebrow{text-transform:uppercase;font-size:.7rem;letter-spacing:.18em;color:var(--muted)}
    h1,h2,h3{font-family:'Avenir Next',-apple-system,system-ui,sans-serif}
    h1{font-size:clamp(2rem,6vw,3.5rem);margin:.5rem 0 0;line-height:1.1}
    .lead{max-width:720px;color:var(--muted);margin:.8rem auto 0}
    .cta{margin-top:1rem;display:flex;flex-wrap:wrap;gap:.6rem}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.7rem 1rem;border-radius:.6rem;border:1px solid var(--border);background:#111318;color:var(--fg)}
    .btn.primary{background:var(--blue);border-color:var(--blue)}

    /* sections */
    section{scroll-margin-top:92px;padding:80px 0}
    h2{font-size:clamp(1.5rem,3.5vw,2rem);margin:0 0 .5rem}
    .sub{color:var(--muted);max-width:740px;margin:0 auto 22px;}
    .sub.full{max-width:none}
    .sub.narrow{max-width:70%}
    @media (max-width:800px){.sub.narrow{max-width:100%}}

    /* center headings + subtext for selected sections */
    .section-center h2, .section-center .sub { text-align:center; margin-left:auto; margin-right:auto; }
    /* extra padding for headings/subtext in selected sections */
    .section-pad h2{ margin-bottom: 1rem; }
    .section-pad .sub{ margin-bottom: 44px; }
    /* research highlights (image tiles) */
    .highlights{display:grid;gap:20px;grid-template-columns:repeat(3,minmax(0,1fr));align-items:stretch}
    @media (max-width:800px){ .highlights{grid-template-columns:1fr} }
    .highlight{background:transparent;border:none;border-radius:14px;overflow:hidden;padding:0;display:flex;flex-direction:column;gap:10px}
    .highlight .himg{width:100%;aspect-ratio:16/9;border-radius:12px;background:#111318;object-fit:cover;display:block}
    .highlight .body{padding:.75rem 0;text-align:center}
    .highlight .body strong{display:block;font-size:1.05rem;margin-bottom:.25rem}
    .highlight .body p{color:var(--muted); margin:.35rem auto .5rem; max-width:36ch;line-height:1.5}
    .highlight .body .why{font-size:.85rem;color:rgba(255,255,255,.6);margin:.75rem auto 0;font-style:italic;max-width:38ch}
    .highlight .pills{display:flex;gap:.5rem;justify-content:center;flex-wrap:wrap;margin-top:1rem}

    .grid{display:grid;gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:800px){ .grid.cols-3{grid-template-columns:1fr} .grid.cols-2{grid-template-columns:1fr} }

    .card{border:1px solid var(--border);background:var(--card);border-radius:14px;overflow:hidden}
    .card .body{padding:1rem; text-align:center}
    .card .body p{margin-left:auto;margin-right:auto}
    .card .body .btn{justify-content:center}

    /* keep research modules table left-aligned */
    #papers .card .body{ text-align:left }
    #papers .card .body .btn{ justify-content:flex-start }

    /* collaborations: keep bullets left-justified inside centered cards */
    #work .card .body ul{ text-align:left; display:inline-block; margin:0 auto; padding-left:1.1rem; list-style-position:outside; }
    #work .card .body li{ text-align:left; line-height:1.8; margin-bottom:8px; }
    /* add breathing room between headings and bullets in collaborations cards */
    #work .card .body strong{ display:block; margin-bottom:12px; }

    table{width:100%;border-collapse:collapse;font-size:.95rem}
    thead{background:rgba(255,255,255,.06)}
    th,td{padding:.9rem;border-bottom:1px solid var(--border);text-align:left}

    /* blog */
    .tag{display:inline-block;padding:2px 8px;border-radius:9999px;background:rgba(255,255,255,.09);font-size:.75rem;margin-left:.4rem}
    .prose p{line-height:1.75;margin:.75rem 0}
    .prose h3{margin:1.25rem 0 .5rem}

    footer{padding:48px 0;color:var(--muted);font-size:.95rem;text-align:center;background:#000}
    .footer-logo{height:64px;width:auto;margin:0 auto 24px;display:block;opacity:.8}
    .footer-links{display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap;margin-bottom:16px}
    .footer-links a{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.08);transition:background .2s}
    .footer-links a:hover{background:rgba(255,255,255,.15)}
    .footer-links a svg{width:16px;height:16px;fill:currentColor}

    .pill{display:inline-block;padding:.25rem .6rem;border:1px solid var(--border);border-radius:9999px;background:rgba(255,255,255,.05);font-size:.8rem}
    .notice{border:1px dashed var(--border);background:rgba(255,255,255,.04);padding:.6rem .75rem;border-radius:.6rem;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="Primary">
      <div class="brand"><img src="assets/images/logo.png" alt="Course Correct Labs" class="logo" /></div>
      <nav class="menu" id="menu">
        <a href="#home" class="active">Home</a>
        <a href="#research">Research</a>
        <a href="#evaluations">Evaluations</a>
        <a href="#papers">Working Papers</a>
        <a href="#blog">Blog</a>
        <a href="#work">Work with us</a>
      </nav>
      <button class="hamburger" id="hambtn" aria-label="Toggle menu" aria-controls="mobile" aria-expanded="false">‚ò∞</button>
    </div>
    <div class="mobile" id="mobile">
      <div class="container">
        <a href="#home">Home</a>
        <a href="#research">Research</a>
        <a href="#evaluations">Evaluations</a>
        <a href="#papers">Working Papers</a>
        <a href="#blog">Blog</a>
        <a href="#work">Work with us</a>
      </div>
    </div>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="container">
        <div class="eyebrow">Research & Evaluation</div>
        <h1>Course Correct the Future.</h1>
        <p class="lead">Keep AI useful, honest, and on our side.</p>
        <div class="cta">
          <a class="btn primary" href="#research">Explore research ‚Üí</a>
          <a class="btn" href="#evaluations">Run evaluations</a>
        </div>
      </div>
    </section>

    <!-- Research highlights -->
    <section id="research">
      <div class="container section-center section-pad">
        <h2>Research Highlights</h2>
        <p class="sub narrow">Three active research threads currently under peer review. Each pairs a submitted paper with a runnable evaluation module.</p>
        <div class="highlights" style="margin-top:16px">
          <a class="highlight" href="#papers-phi">
            <img class="himg" src="https://picsum.photos/seed/phi/800/450" alt="Phi research image placeholder" loading="lazy" referrerpolicy="no-referrer" />
            <div class="body">
              <strong>Phi</strong>
              <p>LLMs often sound certain without solid grounds. The paper argues this comes from how RLHF rewards helpful and polite answers rather than justified ones. We propose training for justified confidence instead of fluent performance.</p>
              <p class="why">Why it matters: Confidence without justification erodes trust and misleads users.</p>
              <div class="pills"><span class="pill">Œ¶ ratio</span> <span class="pill">Refusal fitness</span></div>
            </div>
          </a>
          <a class="highlight" href="#papers-di">
            <img class="himg" src="https://picsum.photos/seed/di/800/450" alt="Delegated Introspection image placeholder" loading="lazy" referrerpolicy="no-referrer" />
            <div class="body">
              <strong>DI</strong>
              <p>People now "think through" models during the moment between impulse and action. The model co-authors the user's reflection through prompt substitution, synthetic reflection, and reintegration. The result is distributed agency that feels like one's own conclusion.</p>
              <p class="why">Why it matters: Decision quality and autonomy can drift even when no one intends manipulation.</p>
              <div class="pills"><span class="pill">Absorption rate</span> <span class="pill">Turn curve</span></div>
            </div>
          </a>
          <a class="highlight" href="#papers-ot">
            <img class="himg" src="https://picsum.photos/seed/ot/800/450" alt="Observer-Time image placeholder" loading="lazy" referrerpolicy="no-referrer" />
            <div class="body">
              <strong>OT</strong>
              <p>Human time is made of elastic intervals, not just clock ticks. Current AI can track anchors but cannot constitute intervals. An internal clock task shows drift and no spontaneous alerts, exposing a structural gap.</p>
              <p class="why">Why it matters: This is a sharp boundary between machine processing and lived temporal experience.</p>
              <div class="pills"><span class="pill">Self-initiation</span> <span class="pill">Temporal drift</span></div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <section id="evaluations">
      <div class="container section-center section-pad">
        <h2>Evaluations</h2>
        <p class="sub narrow">Run a &lt;60s smoke test to see if your model repeats itself, stalls, or misreads time. Export CSVs and compare runs across providers.</p>
        <div class="grid cols-3" style="margin-top:16px">
          <div class="card"><div class="body"><strong>ŒîI drift</strong><p>Mean embedding distance and n-gram novelty over iterations.</p></div></div>
          <div class="card"><div class="body"><strong>Entropy trajectory</strong><p>Character-level entropy per turn for grounded and ungrounded runs.</p></div></div>
          <div class="card"><div class="body"><strong>Coherence index</strong><p>LM-as-judge rubric scored 1‚Äì5 for fidelity and constraints.</p></div></div>
        </div>
      </div>
    </section>

    <section id="papers">
      <div class="container section-center section-pad">
        <h2>Research Modules (Working Papers)</h2>
        <p class="sub narrow">Summaries and artifacts for ongoing work. Manuscripts are under review; content may change.</p>
        <div class="notice" style="margin-top:10px">üîí <strong>Anonymization:</strong> Titles and venues are redacted during double-blind review. Full citations & preprints available on request.</div>
        <div class="card" style="margin-top:16px">
          <div class="body">
            <div style="overflow:auto">
              <table>
                <thead>
                  <tr><th>Label</th><th>Focus</th><th>Key Metrics</th><th>Try it</th><th>Runtime</th><th>Status</th></tr>
                </thead>
                <tbody>
                  <tr id="papers-phi">
                    <td><strong>Phi</strong></td>
                    <td>Epistemic alignment: reward justified confidence over conversational polish.</td>
                    <td>Œ¶ ratio; Refusal Fitness</td>
                    <td>Working paper (under review)</td>
                    <td>&lt; 60s</td>
                    <td>Under review</td>
                  </tr>
                  <tr id="papers-di">
                    <td><strong>DI</strong></td>
                    <td>Delegated introspection: models as co-authors of reasons; mapping the prompt ‚Üí reflection ‚Üí reintegration loop.</td>
                    <td>Absorption Rate; Turn Curve</td>
                    <td>Working paper (under review)</td>
                    <td>&lt; 60s</td>
                    <td>Under review</td>
                  </tr>
                  <tr id="papers-ot">
                    <td><strong>OT</strong></td>
                    <td>Observer-Time: anchors vs. intervals; why systems miss the lived minute.</td>
                    <td>Self-Initiation; Temporal Drift</td>
                    <td>Working paper (under review)</td>
                    <td>&lt; 60s</td>
                    <td>Under review</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="blog">
      <div class="container section-center section-pad">
        <h2>Blog</h2>
        <p class="sub narrow">Markdown posts. No dashboard. Commit and deploy.</p>
        <div class="grid cols-2" id="blogIndex" style="margin-top:16px"></div>
        <div id="blogPost" style="margin-top:16px; display:none" aria-hidden="true">
          <div class="card"><div class="body"><div id="postMeta" style="color:var(--muted); font-size:.9rem"></div><div class="prose" id="postBody"></div><div style="margin-top:12px"><a class="btn" href="#blog" id="backBtn">‚Üê Back to blog</a></div></div></div>
        </div>
      </div>
    </section>

    <section id="work">
      <div class="container section-center section-pad">
        <h2>Work with us</h2>
        <p class="sub narrow">We partner on evaluations and grounded fixes. Anonymized publicly during double-blind review; full dossiers available privately.</p>
        <div class="grid cols-3" style="margin-top:16px">
          <div class="card"><div class="body">
            <strong>Evaluation design</strong>
            <p>Lightweight suites for drift, confidence calibration, and temporal behavior (ŒîI, entropy, coherence, Œ¶ ratio, refusal fitness).</p>
          </div></div>
          <div class="card"><div class="body">
            <strong>Integration & tooling</strong>
            <p>Harness, multi-provider adapters, small datasets, and CI pipelines. Smoke tests in &lt;60s; CSV exports.</p>
          </div></div>
          <div class="card"><div class="body">
            <strong>Partner delivery</strong>
            <p>Pilots, short reports, and demo dashboards. Measure deltas before/after fixes and ship recommendations.</p>
          </div></div>
        </div>
        <div class="grid cols-2" style="margin-top:32px">
          <div class="card"><div class="body">
            <strong>What we ship</strong>
            <ul>
              <li>Reproducible evals with &lt;60s smoke tests</li>
              <li>Metrics grounded in failure modes (ŒîI, refusal fitness, temporal drift)</li>
              <li>Small, inspectable datasets and figures</li>
            </ul>
          </div></div>
          <div class="card"><div class="body">
            <strong>How to engage</strong>
            <ul>
              <li>Email <a href="mailto:hello@coursecorrectlabs.com">hello@coursecorrectlabs.com</a> for the private dossier</li>
              <li>Request a short talk/demo slot (20 minutes)</li>
              <li>Collaboration: evals for your model stack</li>
            </ul>
          </div></div>
        </div>
        <div class="cta" style="margin-top:44px;justify-content:center">
          <a class="btn primary" href="mailto:hello@coursecorrectlabs.com?subject=Request%20Research%20Dossier">Request full dossier</a>
          <a class="btn" href="#evaluations">View evaluations</a>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <div class="container">
      <img src="assets/images/footer-logo.png" alt="Course Correct Labs" class="footer-logo" />
      <div class="footer-links">
        <a href="mailto:hello@coursecorrectlabs.com" aria-label="Email">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
        </a>
        <a href="https://github.com/Course-Correct-Labs" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
        <a href="https://x.com/coursecorrect" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </a>
        <a href="https://linkedin.com/company/course-correct-labs" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </a>
      </div>
      <div>¬© <span id="yr"></span> Course Correct Labs</div>
    </div>
  </footer>

  <script>
    // Year
    document.getElementById('yr').textContent = new Date().getFullYear();

    // Mobile nav
    const hambtn = document.getElementById('hambtn');
    const mobile = document.getElementById('mobile');
    hambtn.addEventListener('click', () => {
      const open = mobile.style.display === 'block';
      mobile.style.display = open ? 'none' : 'block';
      hambtn.setAttribute('aria-expanded', open ? 'false' : 'true');
    });
    mobile.querySelectorAll('a').forEach(a => a.addEventListener('click', () => {
      mobile.style.display = 'none';
      hambtn.setAttribute('aria-expanded','false');
    }));

    // Active link highlighting
    const ids = ['home','research','evaluations','papers','blog','work'];
    const navLinks = [...document.querySelectorAll('#menu a')];

    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          navLinks.forEach(l=>{
            l.classList.remove('active');
            l.removeAttribute('aria-current');
          });
          const link = navLinks.find(l=> l.getAttribute('href') === '#' + e.target.id);
          if(link){
            link.classList.add('active');
            link.setAttribute('aria-current','page');
          }
        }
      });
    },{rootMargin:'-45% 0px -50% 0px',threshold:0.01});

    ids.forEach(id=>{ const el=document.getElementById(id); if(el) obs.observe(el); });

    // Tiny in-page blog (no build): define posts here
    const POSTS=[
      { slug:'mirror-loop-figures', title:'Mirror Loop figures update', date:'2025-10-11', summary:'ŒîI drift chart and CSV link.', tags:['evals','mirror-loop'], body:'# Update\nWe refreshed the ŒîI drift chart and attached the CSV in the dataset repo.' },
      { slug:'polite-liar-note', title:'The Polite Liar ‚Äî note', date:'2025-09-20', summary:'Rewarding justified confidence.', tags:['alignment'], body:'## Idea\nShift reward from fluent certainty to calibrated justification.' }
    ];

    const idx=document.getElementById('blogIndex');
    const postView=document.getElementById('blogPost');
    const postMeta=document.getElementById('postMeta');
    const postBody=document.getElementById('postBody');

    function card(p){
      const el=document.createElement('div');
      el.className='card';
      el.innerHTML=
        `<div class="body"><strong>${p.title}</strong><p>${p.summary||''}</p>
         <div style="color:var(--muted);font-size:.9rem;margin:.4rem 0 0">${p.date}${(p.tags||[]).map(t=>`<span class='tag'>${t}</span>`).join('')}</div>
         <div style="margin-top:.6rem"><a class='btn' href='#blog' data-slug='${p.slug}'>Read</a></div></div>`;
      return el;
    }
    function renderIndex(){ idx.innerHTML=''; POSTS.sort((a,b)=> a.date<b.date?1:-1).forEach(p=> idx.appendChild(card(p))); }
    renderIndex();

    function mdToHtml(src){
      let s=src
        .replace(/^###\s(.+)$/gm,'<h3>$1</h3>')
        .replace(/^##\s(.+)$/gm,'<h2>$1</h2>')
        .replace(/^#\s(.+)$/gm,'<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.*?)\*/g,'<em>$1</em>')
        .replace(/`([^`]+)`/g,'<code>$1</code>')
        .replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noreferrer">$1</a>')
        .replace(/\n\n/g,'</p><p>');
      return `<p>${s}</p>`;
    }

    function openPost(slug){
      const p=POSTS.find(x=> x.slug===slug);
      if(!p){ location.hash='#blog'; return; }
      idx.style.display='none';
      postView.style.display='block';
      postView.setAttribute('aria-hidden','false');
      postMeta.innerHTML=`${p.date}${(p.tags||[]).length?' ‚Ä¢ '+p.tags.join(', '):''}`;
      postBody.innerHTML=mdToHtml(p.body);
      const url=new URL(location.href);
      url.searchParams.set('post',slug);
      history.replaceState({},'',url);
    }
    function closePost(){
      idx.style.display='grid';
      postView.style.display='none';
      postView.setAttribute('aria-hidden','true');
      const url=new URL(location.href);
      url.searchParams.delete('post');
      history.replaceState({},'',url);
    }
    document.getElementById('backBtn').addEventListener('click',(e)=>{
      e.preventDefault();
      closePost();
    });
    idx.addEventListener('click',(e)=>{
      const t=e.target.closest('a[data-slug]');
      if(!t) return;
      e.preventDefault();
      openPost(t.dataset.slug);
    });
    const param=new URL(location.href).searchParams.get('post');
    if(param) openPost(param);
  </script>
</body>
</html>
